close all;
clear all;

% Loading series
Serie_1 = [ -0.0008310194 -184.5; 0.2617626 -200.9867; 0.2993737 -217.4734; 0.4662301 -236.0209; 0.5681219 -252.5076; 0.7001026 -262.8118; 0.7978913 -266.9335; 1.119979 -268.9943; 1.24854 -268.9943; 1.665681 -266.9335; 1.894767 -279.2985; 2.026064 -287.5419; 2.209332 -258.6902; 2.240789 -256.6293; 2.62237 -244.2643; 2.81658 -248.386; 3.011474 -254.5685; 3.298002 -246.3251; 3.298002 -246.3251; 3.426563 -246.3251; 3.65223 -248.386; 3.847807 -256.6293; 3.977736 -260.751; 4.23144 -250.4468; 4.354531 -233.9601; 4.482409 -231.8992; 4.803812 -231.8992; 4.900233 -231.8992; 5.157356 -231.8992; 5.189497 -231.8992; 5.450039 -242.2034; 5.547827 -246.3251; 5.647668 -256.6293; 5.680492 -258.6902; 5.680492 -258.6902; 5.933512 -246.3251; 6.02583 -233.9601; 6.312358 -225.7167; 6.5052 -225.7167; 6.600937 -223.6559; 6.692572 -209.23; 6.815662 -192.7433; 6.814979 -190.6825; 6.9114 -190.6825; 7.007821 -190.6825; 7.168523 -190.6825; 7.425646 -190.6825; 7.714909 -190.6825; 7.77919 -190.6825; 7.909119 -194.8042; 8.006224 -196.865; 8.19975 -198.9258; 8.265398 -203.0475; 8.325576 -190.6825; 8.354297 -180.3783; 8.510212 -165.9524; 8.599794 -145.3441; 8.658605 -128.8574; 8.752975 -122.6748; 8.848712 -120.614; 8.879484 -116.4923; 9.065488 -95.88395; 9.128402 -91.76228; 9.223454 -87.64059; 9.415613 -85.57976; 9.479894 -85.57976; 9.544174 -85.57976; 9.67342 -87.64059; 9.770525 -89.70143; 9.803349 -91.76228; 9.901822 -97.94479; 10.03107 -100.0056; 10.25673 -102.0665; 10.34837 -87.64059; 10.63695 -85.57976; 10.82979 -85.57976; 11.1129 -67.03222; 11.17649 -64.97138; 11.36455 -50.54551; 11.45824 -42.30216; 11.74134 -23.75462; 11.7687 -9.328755; 11.76665 -3.146242; 11.69621 15.4013; 12.11062 25.70549; 12.07437 38.07052; 12.07095 48.37471; 12.10173 52.49638; 12.16601 52.49638; 12.31919 75.1656; 12.47852 79.28728; 12.80198 73.10476; 12.93259 66.92225; 13.06115 66.92225; 13.18151 91.65231; 13.23963 110.1998; 13.23758 116.3824; 13.43042 116.3824; 13.55899 116.3824; 13.97955 108.139; 13.97955 108.139; 14.39942 101.9565; 14.4637 101.9565; 14.81109 120.504; 15.13523 112.2607; 15.39372 108.139; 15.49151 104.0173; 15.65221 104.0173; 15.68367 106.0782; 15.9066 112.2607; 16.06388 122.5649; 16.12679 126.6865; 16.41264 136.9907; 16.66771 143.1732; 16.85987 145.2341; 17.14708 151.4166; 17.4719 141.1124; 17.53618 141.1124; 17.72971 139.0516; 18.08189 143.1732; 18.37183 141.1124; 18.52843 153.4774; 18.72059 155.5383; 18.88608 141.1124; 18.9825 141.1124; 19.23962 141.1124; 19.5877 157.5991; 19.71421 163.7816; 19.90363 174.0858; 20.09511 178.2075; 20.32009 178.2075; 20.67363 178.2075; 21.06137 172.025; 21.31781 174.0858; 21.57493 174.0858; 21.96062 174.0858; 22.12063 176.1467; 22.56444 194.6942; 22.68685 213.2417; 22.78053 221.4851; 22.93577 237.9718; 22.93577 237.9718; 23.15733 248.276; 23.25307 250.3368; 23.34812 254.4585; 23.69961 260.641; 23.69346 279.1886; 23.72081 293.6144; 24.00392 312.162; 24.09761 320.4053; 24.22343 328.6487; 24.25489 330.7095; 24.31917 330.7095; 24.64057 330.7095; 24.67271 330.7095; 24.96471 322.4662; 24.99685 322.4662; 25.36271 285.3711; 25.39485 285.3711; 25.56034 270.9452; 25.66018 260.641; 25.72651 254.4585; 25.82635 244.1543; 25.86328 229.7284; 25.96175 223.5459; 26.06091 215.3026; 26.54438 211.1809; 26.8015 211.1809; 26.96015 217.3634; 27.08529 227.6676; 27.21249 231.7893; 27.46619 242.0935; 27.49833 242.0935; 27.59612 237.9718; 27.69664 225.6068; 27.72947 223.5459; 27.76913 200.8767; 27.84025 180.2683; 27.87581 169.9641; 27.94283 161.7208; 28.00847 157.5991; 28.07412 153.4774; 28.20337 151.4166; 28.39689 149.3558; 28.55896 145.2341; 28.78531 141.1124; 28.97884 139.0516; 29.07594 136.9907; 29.26879 136.9907; 29.45547 155.5383; 29.54984 161.7208; 29.73995 169.9641; 29.83569 172.025; 29.99639 172.025; 30.02921 169.9641; 30.35746 149.3558; 30.49217 130.8082; 30.49286 128.7474; 30.71989 122.5649; 30.817 120.504; 30.9777 120.504; 31.01052 118.4432; 31.33124 120.504; 31.49194 120.504; 31.81335 120.504; 32.03765 122.5649; 32.35563 132.8691; 32.38777 132.8691; 32.65036 116.3824; 32.97245 114.3215; 33.00459 114.3215; 33.39643 95.77398; 33.62004 99.89565; 33.94008 104.0173; 34.06864 104.0173; 34.23003 101.9565; 34.42492 95.77398; 34.58836 87.53062; 34.91318 77.22644; 35.41033 31.888; 35.95877 25.70549; 36.1181 29.82717; 36.44019 27.76633; 36.63235 29.82717; 36.88605 40.13136; 37.11104 40.13136; 37.39893 44.25303; 37.69572 21.58381; 37.72307 36.00968; 38.04242 42.19219; 38.26741 42.19219; 38.4329 27.76633; 38.4329 27.76633; 38.62711 23.64465; 38.91774 19.52298; 39.01553 15.4013; 39.20974 11.27962; 39.53456 0.9754342; 39.79373 -5.207079; 39.85801 -5.207079; 40.14386 5.09711; 40.14386 5.09711; 40.21361 -11.38959; 40.28609 -36.11965; 40.32234 -48.48468; 40.5145 -46.42384; 40.51108 -36.11965; 40.5439 -38.18048; 40.61366 -54.66719; 40.71076 -56.72803; 40.80923 -62.91054; 40.84137 -62.91054; 41.07251 -81.45808; 41.07319 -83.51892; 41.20449 -91.76228; 41.39938 -97.94479; 41.69343 -112.3707; 41.72762 -118.5532; 41.8261 -124.7357; 41.92389 -128.8574; 41.92525 -132.979; 42.25145 -147.4049; 42.28427 -149.4657; 42.53934 -143.2832; 42.57148 -143.2832; 42.70073 -145.3441; 42.73286 -145.3441; 42.79852 -149.4657; 42.99409 -157.7091; 43.05974 -161.8308; 43.19104 -170.0741; 43.28814 -172.1349; 43.38662 -178.3175; 43.48304 -178.3175; 43.51586 -180.3783; 43.71281 -192.7433; 43.71349 -194.8042; 43.97335 -203.0475; 44.07114 -207.1692; 44.29954 -217.4734; 44.29954 -217.4734; 44.3645 -219.5342; 44.52794 -227.7776; 44.56076 -229.8384; 44.72557 -242.2034; 44.79053 -244.2643; 44.8555 -246.3251; 45.05244 -258.6902; 45.08458 -258.6902; 45.08458 -258.6902; 45.40667 -260.751; 45.5325 -252.5076; 45.56259 -246.3251; 45.88946 -262.8118; 45.92228 -264.8727; 45.95784 -275.1768; 45.99203 -281.3594; 46.1247 -293.7244; 46.15821 -297.8461; 46.38935 -316.3936; 46.42217 -318.4544; 46.4885 -324.637; 46.4885 -324.637; 46.55484 -330.8195; 46.68613 -339.0628; 46.75178 -343.1845; 46.75793 -361.7321; 46.7593 -365.8537; 46.7593 -365.8537; 46.85709 -369.9754; 46.88992 -372.0362; 46.98702 -374.0971; 47.21474 -382.3404; 47.21474 -382.3404; 47.21474 -382.3404; 47.50674 -390.5838; 47.60521 -396.7663; 47.63872 -400.888; 47.64077 -407.0705; 47.6777 -421.4963; 47.7112 -425.618; 47.77685 -429.7397; 47.97243 -437.983; 48.07022 -442.1047; 48.10236 -442.1047; 48.26648 -452.4089; 48.33144 -454.4698; 48.4306 -462.7131; 48.52976 -470.9565; 48.56395 -477.139; 48.69525 -485.3823;]; 
figure % Generate plot
plot( Serie_1(:, 1), Serie_1(:, 2))
hold on
xlabel('X pos [um]')
ylabel('Z [nm]')
grid on
grid minor
axis tight

%definiciones de rugosidades.
%https://www.olympus-ims.com/en/metrology/surface-roughness-measurement-portal/parameters/#!cms[focus]=001

Xpos = Serie_1(:,1).*1e-6;
Zpos = Serie_1(:,2).*1e-9;

iRz = (max(Zpos)- min( Zpos)); %Maximum height (Rz)

iRp = max(Zpos) -mean(Zpos); %Maximum profile peak height (Rp)
iRv = mean(Zpos) -min(Zpos) ;%Maximum profile valley depth (Rv)


%saco la ondulaci√≥n importante
sali = smooth(Zpos);

for i = 1:40
	sali = smooth(sali);
end 

figure
plot(Xpos, sali)
hold on
plot(Xpos, Zpos)


Rugo = (Zpos-sali);

figure
plot(Xpos, Rugo)
hold on
xlabel('X pos [um]')
ylabel('Z alta frecuencia [nm]')
grid on
grid minor
axis tight


Rz = (max(Rugo)- min( Rugo)); %Maximum height (Rz)

Rp = max(Rugo) -mean(Rugo); %Maximum profile peak height (Rp)
Rv = mean(Rugo) -min(Rugo) ;%Maximum profile valley depth (Rv)

Rc = MeanHeight(Rugo); %Mean height

Ra = ArithmeticMeanDeviation(Xpos, Rugo); %Arithmetic mean deviation

Rq = RootMeanSquareDeviation(Xpos, Rugo); %Root mean square deviation

Rsk = Skewness(Xpos, Rugo); %Skewness (Rsk)

Rku = Kurtosis(Xpos, Rugo); %Kurtosis (Rku)

RSm = MeanWidth (Xpos, Rugo); %Mean width (RSm)


[puntos, Rdc] = ProfileSectionHeightDifferencePlot(Xpos, Rugo, 100);

figure
plot(puntos, Rdc)



















